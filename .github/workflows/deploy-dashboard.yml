name: deploy-dashboard

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  schedule:
    - cron: '0 1 * * MON-FRI'
  push: 
    branches: 
      master


jobs:
  deploy-dashboard:
    runs-on: macOS-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      - uses: r-lib/actions/setup-r@master
      - name: Install packages
        env: 
          GITHUB_PAT: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          Rscript -e "install.packages(c('shiny', 'rsconnect', 'remotes'), type = 'binary')"
          Rscript -e "remotes::install_version('testthat', '3.0.1')"
          Rscript -e "remotes::install_github('MattCowgill/strayr', dependencies = TRUE, upgrade = FALSE)"
          Rscript -e "remotes::install_github('hamgamb/aititheme', dependencies = TRUE, type = 'binary')"
          Rscript -e "remotes::install_github('hamgamb/aitidata', dependencies = TRUE, type = 'binary')"
          Rscript -e "remotes::install_github('hamgamb/reportabs', dependencies = TRUE, type = 'binary')"
          Rscript -e "remotes::install_github('wfmackey/absmapsdata', dependencies = TRUE, type = 'binary')"
          Rscript -e "remotes::install_deps(type = 'binary', force = FALSE)"

        
      - name: Push to shiny.io
        run: |
          Rscript -e "rsconnect::setAccountInfo(name='aiti', token=${{secrets.SHINYAPPS_TOKEN}}, secret=${{secrets.SHINYAPPS_SECRET}})"
          Rscript -e "rsconnect::deployApp(appName = 'WorkSight')"
     
