name: deploy-dashboard

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  schedule:
     - cron:  '10 1 * * 1-5'

  push:
   branches:
     master


jobs: 
  deploy-dashboard:
    runs-on: macOS-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      - uses: r-lib/actions/setup-r@master
        with:
          r-version: '4.0.2'
      - name: Install packages
        env: 
          GITHUB_PAT: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          Rscript -e "install.packages(c('shiny', 'rsconnect', 'remotes', 'pkgload'), type = 'binary')"
          Rscript -e "remotes::install_deps(type = 'binary', force = FALSE, dependencies = TRUE)"

        
      - name: Push to shiny.io
        run: |
          Rscript -e "rsconnect::setAccountInfo(name='aiti', token='${{secrets.SHINYAPPS_TOKEN}}', secret='${{secrets.SHINYAPPS_SECRET}}')"
          Rscript -e "rsconnect::deployApp(appName = 'WorkSight')"
     
