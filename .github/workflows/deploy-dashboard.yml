name: deploy-dashboard

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  schedule:
    - cron: '0 2 * * MON-FRI'



jobs:
  deploy-dashboard:
    runs-on: windows-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      - uses: r-lib/actions/setup-r@master
      - name: Install packages
        env: 
          GITHUB_PAT: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          Rscript -e "install.packages(c('stringdist', 'rvest', 'stringr', 'xml2', 'remotes', 'rsconnect', 'dplyr', 'forcats', 'lubridate', 'scales', 'zoo', 'shiny', 'shinydashboard', 'shinyWidgets', 'shinycssloaders', 'plotly', 'sf', 'leaflet', 'mapview', 'ggplot2'), type = 'binary')"
          Rscript -e "remotes::install_github('MattCowgill/strayr', dependencies = FALSE)"
          Rscript -e "remotes::install_github('hamgamb/aititheme', dependencies = FALSE)"
          Rscript -e "remotes::install_github('hamgamb/daitir', dependencies = FALSE)"
          Rscript -e "remotes::install_github('hamgamb/reportabs', dependencies = FALSE)"
          Rscript -e "remotes::install_github('wfmackey/absmapsdata', dependencies = FALSE)"
        
      - name: Push to shiny.io
        run: |
          Rscript -e "rsconnect::setAccountInfo(name='aiti', token=${{secrets.SHINYAPPS_TOKEN}}, secret=${{secrets.SHINYAPPS_SECRET}})"
          Rscript -e "rsconnect::deployApp(appName = 'WorkSight')"
     
